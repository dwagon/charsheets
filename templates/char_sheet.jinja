\documentclass[a4,openany,oneside,twocolumn]{book}
\usepackage[justified]{dnd}
\usepackage{dndtemplate}
\usepackage{bookmark}
\setlength\oddsidemargin{\dimexpr(\paperwidth-\textwidth)/2 - 1in\relax}
\setlength\evensidemargin{\oddsidemargin}

% Headline
\CharacterName{[[X.name]]}

\Class{[[X.class_description]]}
\Background{[[X.origin]]}
\PlayerName{[[X.player_name]]}
\Race{[[X.species.name]]}
\Alignment{[[X.alignment]]}
\XP{Milestone}

% Ability scores
\StrengthScore{[[X.strength.value]]}    % [[X.strength.value.reason]]
\DexterityScore{[[X.dexterity.value]]}  % [[X.dexterity.value.reason]]
\ConstitutionScore{[[X.constitution.value]]}    % [[X.constitution.value.reason]]
\IntelligenceScore{[[X.intelligence.value]]}    % [[X.intelligence.value.reason]]
\WisdomScore{[[X.wisdom.value]]}        % [[X.wisdom.value.reason]]
\CharismaScore{[[X.charisma.value]]}    % [[X.charisma.value.reason]]

% Ability modifiers
\StrengthModifier{[[X.strength.modifier]]}
\DexterityModifier{[[X.dexterity.modifier]]}
\ConstitutionModifier{[[X.constitution.modifier]]}
\IntelligenceModifier{[[X.intelligence.modifier]]}
\WisdomModifier{[[X.wisdom.modifier]]}
\CharismaModifier{[[X.charisma.modifier]]}

% Saving Throws
\StrengthSavingThrowModifier{[[X.strength.saving_throw]]}
\DexteritySavingThrowModifier{[[X.dexterity.saving_throw]]}
\ConstitutionSavingThrowModifier{[[X.constitution.saving_throw]]}
\IntelligenceSavingThrowModifier{[[X.intelligence.saving_throw]]}
\WisdomSavingThrowModifier{[[X.wisdom.saving_throw]]}
\CharismaSavingThrowModifier{[[X.charisma.saving_throw]]}

\AcrobaticsSkillModifier{[[X.Acrobatics.modifier]]}             % [[X.Acrobatics.modifier.reason]]
\AnimalHandlingSkillModifier{[[X.Animal_Handling.modifier]]}    % [[X.Animal_Handling.modifier.reason]]
\ArcanaSkillModifier{[[X.Arcana.modifier]]}                     % [[X.Arcana.modifier.reason]]
\AthleticsSkillModifier{[[X.Athletics.modifier]]}               % [[X.Athletics.modifier.reason]]
\DeceptionSkillModifier{[[X.Deception.modifier]]}               % [[X.Deception.modifier.reason]]
\HistorySkillModifier{[[X.History.modifier]]}                   % [[X.History.modifier.reason]]
\InsightSkillModifier{[[X.Insight.modifier]]}                   % [[X.Insight.modifier.reason]]
\IntimidationSkillModifier{[[X.Intimidation.modifier]]}         % [[X.Intimidation.modifier.reason]]
\InvestigationSkillModifier{[[X.Investigation.modifier]]}       % [[X.Investigation.modifier.reason]]
\MedicineSkillModifier{[[X.Medicine.modifier]]}                 % [[X.Medicine.modifier.reason]]
\NatureSkillModifier{[[X.Nature.modifier]]}                     % [[X.Nature.modifier.reason]]
\PerceptionSkillModifier{[[X.Perception.modifier]]}             % [[X.Perception.modifier.reason]]
\PerformanceSkillModifier{[[X.Performance.modifier]]}           % [[X.Performance.modifier.reason]]
\PersuasionSkillModifier{[[X.Persuasion.modifier]]}             % [[X.Persuasion.modifier.reason]]
\ReligionSkillModifier{[[X.Religion.modifier]]}                 % [[X.Religion.modifier.reason]]
\SleightOfHandSkillModifier{[[X.Sleight_Of_Hand.modifier]]}     % [[X.Sleight_Of_Hand.modifier.reason]]
\StealthSkillModifier{[[X.Stealth.modifier]]}                   % [[X.Stealth.modifier.reason]]
\SurvivalSkillModifier{[[X.Survival.modifier]]}                 % [[X.Survival.modifier.reason]]

% Proficiencies
\SetStrengthProficiency{[[X.strength.proficient]]}
\SetDexterityProficiency{[[X.dexterity.proficient]]}
\SetConstitutionProficiency{[[X.constitution.proficient]]}
\SetIntelligenceProficiency{[[X.intelligence.proficient]]}
\SetWisdomProficiency{[[X.wisdom.proficient]]}
\SetCharismaProficiency{[[X.charisma.proficient]]}

\SetAcrobaticsProficiency{[[ X.acrobatics.prof ]]}          % [[X.Acrobatics.origin]]
\SetAnimalHandlingProficiency{[[ X.animal_handling.prof ]]} % [[X.Animal_Handling.origin]]
\SetArcanaProficiency{[[ X.arcana.prof ]]}                  % [[X.Arcana.origin]]
\SetAthleticsProficiency{[[ X.athletics.prof ]]}            % [[X.Athletics.origin]]
\SetDeceptionProficiency{[[ X.deception.prof ]]}            % [[X.Deception.origin]]
\SetHistoryProficiency{[[ X.history.prof ]]}                % [[X.History.origin]]
\SetInsightProficiency{[[ X.insight.prof ]]}                % [[X.Insight.origin]]
\SetIntimidationProficiency{[[ X.intimidation.prof ]]}      % [[X.Intimidation.origin]]
\SetInvestigationProficiency{[[ X.investigation.prof ]]}    % [[X.Investigation.origin]]
\SetMedicineProficiency{[[ X.medicine.prof ]]}              % [[X.Medicine.origin]]
\SetNatureProficiency{[[ X.nature.prof ]]}                  % [[X.Nature.origin]]
\SetPerceptionProficiency{[[ X.perception.prof ]]}          % [[X.Perception.origin]]
\SetPerformanceProficiency{[[ X.performance.prof ]]}        % [[X.Performance.origin]]
\SetPersuasionProficiency{[[ X.persuasion.prof ]]}          % [[X.Persuasion.origin]]
\SetReligionProficiency{[[ X.religion.prof ]]}              % [[X.Religion.origin]]
\SetSleightOfHandProficiency{[[ X.sleight_of_hand.prof ]]}  % [[X.Sleight_Of_Hand.origin]]
\SetStealthProficiency{[[ X.stealth.prof ]]}                % [[X.Stealth.origin]]
\SetSurvivalProficiency{[[ X.survival.prof ]]}              % [[X.Survival.origin]]

\Inspiration{}
\Proficiency{[[X.proficiency_bonus]]}
\Perception{[[X.passive_perception]]}

\ArmorClass{[[X.ac]]} % [[X.ac.reason]]
\Initiative{[[X.initiative]]}   % [[X.initiative.reason]]
\Speed{\parbox{40pt}{\centering [[X.speed]] % [[X.speed.reason]]

[% if X.fly_speed %]\small{(Fly~[[X.fly_speed]])} % [[X.fly_speed.reason]] [% endif %]
[% if X.swim_speed %]\small{(Swim~[[X.swim_speed]])} % [[X.swim_speed.reason]] [% endif %]
}}
\MaxHitPoints{[[X.hp]]} % [[X.hp.reason]]

\MaxHitDice{[[X.max_hit_dice]]}
\CurrentHitDice{}

\CP{}
\SP{}
\GP{}
\EP{}
\PP{}

[% for weapon in X.weapons|sort %]
\AddWeapon{[[weapon.name]]}{[[weapon.atk_bonus]] % [[weapon.atk_bonus.reason]]
}{[[weapon.dmg_dice]][[weapon.dmg_bonus]]  % [[weapon.dmg_bonus.reason]]
/[[weapon.dmg_type.title()]]}
[% if weapon.mastery -%]\AddWeapon{}{}{[[weapon.mastery.title()]]}[%- endif -%]
[% if weapon.properties -%]
[% for property in weapon.properties %]
\AddWeapon{}{}{
[%- if property == "range" -%]
[[weapon.range[0]]]/[[weapon.range[1]]]
[%- else -%]
[[property.title()|replace("_", " ")]]
[%- endif -%]}
[%- endfor -%]
[%- endif %]
[%- endfor %]

[% for attack in X.additional_attacks %]
\AddWeapon{[[attack.name]]}{[[attack.atk_bonus]]}{[[attack.dmg_dice]][[attack.dmg_bonus]]/[[attack.dmg_type]]}
[% endfor %]

\AttacksAdditional{
[% for attack in X.extra_attacks %]
[[attack]]
[% endfor %]
}

\OtherProficienciesLanguages{\textbf{Languages:}
[% for language in X.languages -%]
[[language.value.title()]][[ "," if not loop.last else ""]] % [[language.reason]]
[% endfor %] \\
\textbf{Weapons}:
[% for prof in X.weapon_proficiencies() -%] [[prof.value]][[ "," if not loop.last else ""]] % [[prof.reason]]
[% endfor -%] \\
\textbf{Armor}:
[% for prof in X.armour_proficiencies() -%][[prof.value]][[ "," if not loop.last else ""]] % [[prof.reason]]
[% endfor -%] \\
\textbf{Other}:
[% for prof in X.tool_proficiencies -%][[prof.value]][[ "," if not loop.last else ""]] % [[prof.reason]]
[% endfor -%]
}

\Equipment{
\textbf{Armor}: [[X.armour]] \\
[% if X.shield %]\textbf{Shield}: [[X.shield]]\\[% endif -%]
\begin{itemize}
[%- for equip in X.equipment %]
\item [[equip]]
[%- endfor %]
\end{itemize}
}

\PersonalityTraits{
[% if X.damage_resistances %]
\textbf{Damage Resistance:}
\begin{itemize}
[% for dmg_type in X.damage_resistances %]\item [[dmg_type.value.title()]] Resistant % [[dmg_type.reason]]
[% endfor -%]
\end{itemize}
[% endif -%]
}

\Ideals{
\textbf{Senses:}
\begin{itemize}
[%- for sense in X.senses %]
\item [[sense.value]]   % [[sense.reason]]
[%- endfor %]
\end{itemize}
}

\Bonds{}
\Flaws{}

\FeaturesTraits{
[%- for feat in X.display_features(show_hidden=True) %]
\normal{[[feat.tag.title()|replace("_", " ")]]} [% for goes in range(feat.goes) %]\circ[% endfor %]\\
[%- endfor %]
}

\AdditionalFeaturesAndTraits{
}

% Hidden Features
% [% for feat in X.display_features(hidden_only=True) %] [[feat.tag|replace("_", " ")]]; [% endfor %]

% Appearance
\Age{[[X.age]]}
\Height{[[X.height]]}
\Weight{[[X.weight]]}
\Eyes{[[X.eyes]]}
\Skin{[[X.skin]]}
\Hair{[[X.hair]]}

% background
\CharacterAppearance{\includegraphics[width=5.75cm]{[[X.image]]}}
\Characterbackground{[[X.class_special]]}

\CharacterNotes{
[%- for feat in X.display_features() %]
\textbf{[[feat.tag.title()|replace("_", " ")]]}: [% for goes in range(feat.goes) %]\bigcirc[% endfor %]
[% if feat.partial_rest %] 1/SR All/LR [% elif feat.short_rest %] /SR [% elif feat.long_rest %] /LR [% endif %] \\
[[feat.desc]] \\
[%- endfor %]
  }

\Treasure{}
\AlliesAndOrganizations{}
\OrganizationName{\centering{}
}

[% if X.known_spells.length() or X.spell_casting_ability %] %Magic
\SpellcastingClass{[[X.class_description]]}
\SpellcastingAbility{[[X.spell_casting_ability|title]]}
\SpellSaveDC{[[X.spell_save_dc]]}
\SpellAttackBonus{[[X.spell_attack_bonus]]}

\FirstLevelSpellSlotsTotal{[[X.spell_slots(1)]]}
\SecondLevelSpellSlotsTotal{[[X.spell_slots(2)]]}
\ThirdLevelSpellSlotsTotal{[[X.spell_slots(3)]]}
\FourthLevelSpellSlotsTotal{[[X.spell_slots(4)]]}
\FifthLevelSpellSlotsTotal{[[X.spell_slots(5)]]}
\SixthLevelSpellSlotsTotal{[[X.spell_slots(6)]]}
\SeventhLevelSpellSlotsTotal{[[X.spell_slots(7)]]}
\EighthLevelSpellSlotsTotal{[[X.spell_slots(8)]]}
\NinthLevelSpellSlotsTotal{[[X.spell_slots(9)]]}

\newcommand{\myspell}[3]{\makebox[4cm][l]{#1}\hfill \makebox[0.8cm][l]{#2} \hfill \makebox[0.5cm][r]{#3}}
[% for index, prepared, spell, school, flags, reason in X.level_spells(0) -%]
\CantripSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}}   % [[reason]]
[% endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(1) %]
\FirstLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \FirstLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(2) %]
\SecondLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \SecondLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]}% [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(3) %]
\ThirdLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \ThirdLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(4) %]
\FourthLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \FourthLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(5) %]
\FifthLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \FifthLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(6) %]
\SixthLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \SixthLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(7) %]
\SeventhLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \SeventhLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(8) %]
\EighthLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \EighthLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(9) %]
\NinthLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \NinthLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]
[% endif %]

\begin{document}
\newgeometry{left=0cm,right=0cm,top=0cm,bottom=0cm}
\onecolumn

% CHARACTER PAGE
\pdfbookmark[0]{Character Sheet}{Character Sheet}
\rendercharactersheet

% BACKSTORY PAGE
\pdfbookmark[0]{Background Sheet}{Background Sheet}
\renderbackgroundsheet

[% if X.known_spells.length() or X.spell_casting_ability %]
% SPELLCASTING PAGE
\pdfbookmark[0]{Spellcasting Sheet}{Spellcasting Sheet}
[% if X.half_spell_sheet() %]
\renderhalfspellsheet
[% else -%]
\renderspellsheet
[% endif -%]

[% if X.has_overflow_spells() %]
[% for index, prepared, spell, school, flags, reason in X.level_spells(0, True) %]
\CantripSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}}  % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(1, True) %]
\FirstLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \FirstLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]}  % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(2, True) %]
\SecondLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \SecondLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]}  % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(3, True) %]
\ThirdLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \ThirdLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(4, True) %]
\FourthLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \FourthLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(5, True) %]
\FifthLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \FifthLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(6, True) %]
\SixthLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \SixthLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(7, True) %]
\SeventhLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \SeventhLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(8, True) %]
\EighthLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \EighthLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% for index, prepared, spell, school, flags, reason in X.level_spells(9, True) %]
\NinthLevelSpellSlot[[index]]{\myspell{[[spell]]}{[[school]]}{[[flags]]}} \NinthLevelSpellSlot[[index]]Prepared{[%- if prepared %]True[% else %]False[%- endif -%]} % [[reason]]
[%- endfor %]

[% if X.half_spell_sheet() %]
\renderhalfspellsheet
[% else -%]
\renderspellsheet
[% endif -%]

[% endif %] [# if X.has_overflow_spells() #]
[% endif %] [# if X.spell_casting_ability #]


% NOTES PAGE
\pdfbookmark[0]{Notes Sheet}{Notes Sheet}
\rendernotessheet
\end{document}
