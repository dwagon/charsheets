\documentclass[a4,openany,oneside,twocolumn]{book}

\usepackage[justified]{dnd}
\usepackage{ifthen}

\usepackage{dndtemplate}
\usepackage{bookmark}

\setlength\oddsidemargin{\dimexpr(\paperwidth-\textwidth)/2 - 1in\relax}
\setlength\evensidemargin{\oddsidemargin}

% Headline
\CharacterName{[[X.name]]}

\Class{[[X.class_name|replace("_", " ")]] [[X.level]]}
\Background{[[X.origin.title()]]}
\PlayerName{[[X.player_name]]}
\Race{[[X.species.name]]}
\Alignment{[[X.alignment]]}
\XP{Milestone}

% Ability scores
\StrengthScore{[[X.strength.value]]}
\DexterityScore{[[X.dexterity.value]]}
\ConstitutionScore{[[X.constitution.value]]}
\IntelligenceScore{[[X.intelligence.value]]}
\WisdomScore{[[X.wisdom.value]]}
\CharismaScore{[[X.charisma.value]]}

% Ability modifiers
\StrengthModifier{[[X.strength.modifier]]}
\DexterityModifier{[[X.dexterity.modifier]]}
\ConstitutionModifier{[[X.constitution.modifier]]}
\IntelligenceModifier{[[X.intelligence.modifier]]}
\WisdomModifier{[[X.wisdom.modifier]]}
\CharismaModifier{[[X.charisma.modifier]]}

% Saving Throws
\StrengthSavingThrowModifier{[[X.strength.saving_throw]]}
\DexteritySavingThrowModifier{[[X.dexterity.saving_throw]]}
\ConstitutionSavingThrowModifier{[[X.constitution.saving_throw]]}
\IntelligenceSavingThrowModifier{[[X.intelligence.saving_throw]]}
\WisdomSavingThrowModifier{[[X.wisdom.saving_throw]]}
\CharismaSavingThrowModifier{[[X.charisma.saving_throw]]}

\AcrobaticsSkillModifier{[[X.Acrobatics.modifier]]}
\AnimalHandlingSkillModifier{[[X.Animal_Handling.modifier]]}
\ArcanaSkillModifier{[[X.Arcana.modifier]]}
\AthleticsSkillModifier{[[X.Athletics.modifier]]}
\DeceptionSkillModifier{[[X.Deception.modifier]]}
\HistorySkillModifier{[[X.History.modifier]]}
\InsightSkillModifier{[[X.Insight.modifier]]}
\IntimidationSkillModifier{[[X.Intimidation.modifier]]}
\InvestigationSkillModifier{[[X.Investigation.modifier]]}
\MedicineSkillModifier{[[X.Medicine.modifier]]}
\NatureSkillModifier{[[X.Nature.modifier]]}
\PerceptionSkillModifier{[[X.Perception.modifier]]}
\PerformanceSkillModifier{[[X.Performance.modifier]]}
\PersuasionSkillModifier{[[X.Persuasion.modifier]]}
\ReligionSkillModifier{[[X.Religion.modifier]]}
\SleightOfHandSkillModifier{[[X.Sleight_Of_Hand.modifier]]}
\StealthSkillModifier{[[X.Stealth.modifier]]}
\SurvivalSkillModifier{[[X.Survival.modifier]]}

% Proficiencies
\SetStrengthProficiency{[[X.strength.proficient]]}
\SetDexterityProficiency{[[X.dexterity.proficient]]}
\SetConstitutionProficiency{[[X.constitution.proficient]]}
\SetIntelligenceProficiency{[[X.intelligence.proficient]]}
\SetWisdomProficiency{[[X.wisdom.proficient]]}
\SetCharismaProficiency{[[X.charisma.proficient]]}

\SetAcrobaticsProficiency{[[X.Acrobatics.proficient]]}          % [[X.Acrobatics.origin]]
\SetAnimalHandlingProficiency{[[X.Animal_Handling.proficient]]} % [[X.Animal_Handling.origin]]
\SetArcanaProficiency{[[X.Arcana.proficient]]}                  % [[X.Arcana.origin]]
\SetAthleticsProficiency{[[X.Athletics.proficient]]}            % [[X.Athletics.origin]]
\SetDeceptionProficiency{[[X.Deception.proficient]]}            % [[X.Deception.origin]]
\SetHistoryProficiency{[[X.History.proficient]]}                % [[X.History.origin]]
\SetInsightProficiency{[[X.Survival.proficient]]}               % [[X.Survival.origin]]
\SetIntimidationProficiency{[[X.Intimidation.proficient]]}      % [[X.Intimidation.origin]]
\SetInvestigationProficiency{[[X.Investigation.proficient]]}    % [[X.Investigation.origin]]
\SetMedicineProficiency{[[X.Medicine.proficient]]}              % [[X.Medicine.origin]]
\SetNatureProficiency{[[X.Nature.proficient]]}                  % [[X.Nature.origin]]
\SetPerceptionProficiency{[[X.Perception.proficient]]}          % [[X.Perception.origin]]
\SetPerformanceProficiency{[[X.Performance.proficient]]}        % [[X.Performance.origin]]
\SetPersuasionProficiency{[[X.Persuasion.proficient]]}          % [[X.Persuasion.origin]]
\SetReligionProficiency{[[X.Religion.proficient]]}              % [[X.Religion.origin]]
\SetSleightOfHandProficiency{[[X.Sleight_Of_Hand.proficient]]}  % [[X.Sleight_Of_Hand.origin]]
\SetStealthProficiency{[[X.Stealth.proficient]]}                % [[X.Stealth.origin]]
\SetSurvivalProficiency{[[X.Survival.proficient]]}              % [[X.Survival.origin]]

\Inspiration{}
\Proficiency{[[X.proficiency_bonus]]}
\Perception{[[X.perception]]}

\ArmorClass{[[X.ac]]} % [[X.ac.reason]]
\Initiative{[[X.initiative]]}   % [[X.initiative.reason]]
\Speed{[[X.speed]]}
\MaxHitPoints{[[X.hp]]}


\MaxHitDice{[[X.hit_dice]]}
\CurrentHitDice{}

\CP{}
\SP{}
\GP{}
\EP{}
\PP{}

[% for name, weapon in X.weapons.items() %]
\AddWeapon{[[weapon.name.title()]]}{[[weapon.atk_bonus]] % [[weapon.atk_bonus.reason]]
}{[[weapon.dmg_dice]][[weapon.dmg_bonus]]  % [[weapon.dmg_bonus.reason]]
/[[weapon.dmg_type.title()]]}
[% if weapon.mastery -%]\AddWeapon{}{}{[[weapon.mastery.title()]]}[%- endif -%]
[% if weapon.properties -%]
[% for property in weapon.properties %]
\AddWeapon{}{}{
[%- if property == "range" -%]
[[weapon.range[0]]]/[[weapon.range[1]]]
[%- else -%]
[[property.title()|replace("_", " ")]]
[%- endif -%]}
[%- endfor -%]
[%- endif %]
[%- endfor %]

\AttacksAdditional{}

\OtherProficienciesLanguages{\textbf{Languages:} [[ X.languages|join(', ') ]] \\
\textbf{Weapons}: \begin{itemize}[% for prof in X.weapon_proficiencies() -%]\item [[prof.title()|replace("_", " ")]] [%endfor%]\end{itemize} \\
\textbf{Armor}: \begin{itemize}[% for prof in X.armour_proficiencies() -%]\item [[prof.title()|replace("_", " ")]] [%endfor%]\end{itemize} \\
\textbf{Other}: \begin{itemize}[% for prof in X.other_proficiencies -%]\item [[prof.title()|replace("_", " ")]] [%endfor%]\end{itemize}}

\Equipment{
\textbf{Armor}: [[X.armour]] \\
[% if X.shield %]\textbf{Shield}: Shield \\[% endif -%]
\begin{itemize}
[%- for equip in X.equipment %]
\item [[equip]]
[%- endfor %]
\end{itemize}
\\ \footnotesize{
[% if X.weight %]
\textbf{Weight:} [[X.weight]] lb \\
[% endif %]
[% if X.capacity %]
\textbf{Capacity:} [[X.capacity]] lb
[% endif %]
}}

\PersonalityTraits{Lorem Traits}

\Ideals{Lorem Ideals}

\Bonds{Lorem Bonds}

\Flaws{Lorem Flaws}

\FeaturesTraits{
[% for name, feat in X.feats.items() -%]
\textbf{[[name.title()|replace("_", " ")]]}:
[[feat.desc]] \\
[% endfor %]
}


% Appearance

\Age{[[X.age]]}
\Height{[[X.height]]}
\Weight{[[X.weight]]}
\Eyes{[[X.eyes]]}
\Skin{[[X.skin]]}
\Hair{[[X.hair]]}

% background

\CharacterAppearance{\includegraphics[width=5.75cm]{[[X.image]]}}
\AdditionalFeaturesAndTraits{
[% for name, ability in X.abilities.items() -%]
\textbf{[[name.title()|replace("_", " ")]]}:
[[ability.desc]] \\
[% endfor %]
}

\Characterbackground{Lorum Background}

\Treasure{}
\AlliesAndOrganizations{}
\OrganizationName{\centering{}
}


%Magic
[% if X.spell_casting_ability %]
\SpellcastingClass{[[X.char_class.class_name.title()]] [[X.level]]}
\SpellcastingAbility{[[X.spell_casting_ability]]}
\SpellSaveDC{[[X.spell_save_dc]]}
\SpellAttackBonus{[[X.spell_attack_bonus]]}

\FirstLevelSpellSlotsTotal{[[X.spell_slots(1)]]}
\SecondLevelSpellSlotsTotal{[[X.spell_slots(2)]]}
\ThirdLevelSpellSlotsTotal{[[X.spell_slots(3)]]}
\FourthLevelSpellSlotsTotal{[[X.spell_slots(4)]]}
\FifthLevelSpellSlotsTotal{[[X.spell_slots(5)]]}
\SixthLevelSpellSlotsTotal{[[X.spell_slots(6)]]}
\SeventhLevelSpellSlotsTotal{[[X.spell_slots(7)]]}
\EighthLevelSpellSlotsTotal{[[X.spell_slots(8)]]}
\NinthLevelSpellSlotsTotal{[[X.spell_slots(9)]]}

[% for index, spell in X.spells(0) -%]
\CantripSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor %]

[% if X.max_spell_level(X.level) >= 1 -%]
[% for index, spell in X.spells(1) %]
\FirstLevelSpellSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor -%]
[% endif -%]

[% if X.max_spell_level(X.level) >= 2 -%]
[% for index, spell in X.spells(2) %]
\SecondLevelSpellSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor -%]
[% endif -%]

[% if X.max_spell_level(X.level) >= 3 -%]
[% for index, spell in X.spells(3) %]
\ThirdLevelSpellSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor -%]
[% endif %]

[% if X.max_spell_level(X.level) >= 4 -%]
[% for index, spell in X.spells(4) %]
\FourthLevelSpellSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor -%]
[% endif %]

[% if X.max_spell_level(X.level) >= 5 -%]
[% for index, spell in X.spells(5) %]
\FifthLevelSpellSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor %]
[% endif %]
[% endif %]

\begin{document}
\newgeometry{left=0cm,right=0cm,top=0cm,bottom=0cm}
\onecolumn

% CHARACTER PAGE
\pdfbookmark[0]{Character Sheet}{Character Sheet}
\rendercharactersheet

% BACKSTORY PAGE
\pdfbookmark[0]{Background Sheet}{Background Sheet}
\renderbackgroundsheet
[% if X.spell_casting_ability %]
% SPELLCASTING PAGE
\pdfbookmark[0]{Spellcasting Sheet}{Spellcasting Sheet}
[% if X.half_spell_sheet %]
\renderhalfspellsheet
[% else -%]
\renderspellsheet
[% endif -%]

[% if X.has_overflow_spells() %]
[% for index, spell in X.overflow_spells(0) %]
\CantripSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor -%]

[% for index, spell in X.overflow_spells(1) %]
\FirstLevelSpellSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor -%]

[% for index, spell in X.overflow_spells(2) %]
\SecondLevelSpellSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor -%]

[% for index, spell in X.overflow_spells(3) %]
\ThirdLevelSpellSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor -%]

[% for index, spell in X.overflow_spells(4) %]
\FourthLevelSpellSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor -%]

[% for index, spell in X.overflow_spells(5) %]
\FifthLevelSpellSlot[[index]]{[[spell.title()|replace("_", " ")]]}
[%- endfor -%]

[% if X.half_spell_sheet %]
\renderhalfspellsheet
[% else -%]
\renderspellsheet
[% endif -%]
[% endif %]
[% endif %]

\end{document}
